<app-header></app-header>
<main class="project-detail-main">
  <div *ngIf="loading" class="loading">Chargement du projet...</div>
  <div *ngIf="error" class="error-msg">{{ error }}</div>

  <div *ngIf="project && !loading" class="project-container">
    <div class="project-header">
      <div>
        <h1 class="project-name">{{ project.name }}</h1>
        <p class="project-description">{{ project.description }}</p>
      </div>
      <button (click)="openCreateStoryModal()" class="create-story-btn">CrÃ©er une User Story</button>
    </div>

    <div class="project-members">
      <strong>Membres:</strong>
      <span class="member-badge owner">{{ project.owner.username }} (PropriÃ©taire)</span>
      <span *ngFor="let member of project.members.slice(0, project.members.length - 1)" class="member-badge">
        {{ member.username }}
      </span>
    </div>

    <div class="kanban-board">
      <!-- To Do Column -->
      <div class="kanban-column">
        <h2 class="column-title todo">Ã€ Faire</h2>
        <div class="story-list">
          <div *ngFor="let story of getStoriesByStatus('TODO')" class="story-card">
            <button (click)="deleteUserStory(story.id, $event)" class="delete-story-btn" title="Supprimer">Ã—</button>
            <button (click)="openEditStoryModal(story, $event)" class="edit-story-btn" title="Modifier">âœŽ Modifier</button>
            <h3 class="story-title">{{ story.title }}</h3>
            <p class="story-priority" [ngClass]="story.priority.toLowerCase()">
              <span class="priority-badge">{{ getPriorityLabel(story.priority) }}</span>
            </p>
            <p class="story-description" *ngIf="story.description">{{ story.description }}</p>
            <div *ngIf="story.assignedTo" class="story-assignee">
              ðŸ‘¤ {{ story.assignedTo.username }}
            </div>
          </div>
        </div>
      </div>

      <!-- In Progress Column -->
      <div class="kanban-column">
        <h2 class="column-title in-progress">En Cours</h2>
        <div class="story-list">
          <div *ngFor="let story of getStoriesByStatus('IN_PROGRESS')" class="story-card">
            <button (click)="deleteUserStory(story.id, $event)" class="delete-story-btn" title="Supprimer">Ã—</button>
            <button (click)="openEditStoryModal(story, $event)" class="edit-story-btn" title="Modifier">âœŽ Modifier</button>
            <h3 class="story-title">{{ story.title }}</h3>
            <p class="story-priority" [ngClass]="story.priority.toLowerCase()">
              <span class="priority-badge">{{ getPriorityLabel(story.priority) }}</span>
            </p>
            <p class="story-description" *ngIf="story.description">{{ story.description }}</p>
            <div *ngIf="story.assignedTo" class="story-assignee">
              ðŸ‘¤ {{ story.assignedTo.username }}
            </div>
          </div>
        </div>
      </div>

      <!-- Done Column -->
      <div class="kanban-column">
        <h2 class="column-title done">TerminÃ©</h2>
        <div class="story-list">
          <div *ngFor="let story of getStoriesByStatus('DONE')" class="story-card">
            <button (click)="deleteUserStory(story.id, $event)" class="delete-story-btn" title="Supprimer">Ã—</button>
            <button (click)="openEditStoryModal(story, $event)" class="edit-story-btn" title="Modifier">âœŽ Modifier</button>
            <h3 class="story-title">{{ story.title }}</h3>
            <p class="story-priority" [ngClass]="story.priority.toLowerCase()">
              <span class="priority-badge">{{ getPriorityLabel(story.priority) }}</span>
            </p>
            <p class="story-description" *ngIf="story.description">{{ story.description }}</p>
            <div *ngIf="story.assignedTo" class="story-assignee">
              ðŸ‘¤ {{ story.assignedTo.username }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<app-user-story-form
  [show]="showCreateStoryModal"
  [mode]="'create'"
  [members]="project?.members || []"
  [error]="userStoryError"
  (closeModal)="closeCreateStoryModal()"
  (submitForm)="onCreateUserStory($event)"
></app-user-story-form>

<app-user-story-form
  [show]="showEditStoryModal"
  [mode]="'edit'"
  [story]="currentEditingStory"
  [members]="project?.members || []"
  [error]="editUserStoryError"
  (closeModal)="closeEditStoryModal()"
  (submitForm)="onEditUserStory($event)"
></app-user-story-form>
